import { nanoid } from "nanoid";
function pickFeatureId(goal) {
    if (goal.featureId)
        return goal.featureId;
    const base = (goal.title || goal.text || "feature").toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/(^-|-$)/g, "");
    return base.slice(0, 24) || `feature-${nanoid(6)}`;
}
function titleCase(s) {
    return s
        .replace(/[-_]/g, " ")
        .replace(/\b\w/g, (c) => c.toUpperCase())
        .trim();
}
function wantsAvoidDeps(c) {
    return (c?.newDependencies ?? "avoid") === "avoid";
}
function classifyGoal(text) {
    const t = text.toLowerCase();
    if (t.includes("feedback") || t.includes("contact") || t.includes("report a bug"))
        return "feedback";
    if (t.includes("setting") || t.includes("preferences") || t.includes("profile"))
        return "settings";
    return "playground";
}
export function proposeIntents(goal) {
    const featureId = pickFeatureId(goal);
    const recipe = classifyGoal(goal.text);
    const baseTitle = goal.title ?? titleCase(recipe);
    const target = "react-vite-shadcn-tailwind4";
    if (recipe === "feedback") {
        const A = {
            feature: { id: featureId, title: `${baseTitle} (minimal)`, summary: "User feedback page (form placeholder) with small footprint." },
            target,
            intent: {
                pages: [
                    {
                        name: "Feedback",
                        title: "Feedback",
                        routeHint: "/feedback",
                        kind: "form",
                        sections: [
                            { type: "heading", text: "Feedback" },
                            { type: "paragraph", text: "This is a placeholder feedback form page generated by WebSpec." },
                            { type: "callout", text: "In a real app, wire this to your API or storage." }
                        ]
                    }
                ]
            },
            constraints: goal.constraints
        };
        const B = {
            feature: { id: featureId, title: `${baseTitle} (with admin list)`, summary: "Feedback page plus an admin list page." },
            target,
            intent: {
                pages: [
                    {
                        name: "Feedback",
                        title: "Feedback",
                        routeHint: "/feedback",
                        kind: "form",
                        sections: [
                            { type: "heading", text: "Feedback" },
                            { type: "paragraph", text: "Submit feedback (placeholder UI)." }
                        ]
                    },
                    {
                        name: "FeedbackAdmin",
                        title: "Feedback Admin",
                        routeHint: "/admin/feedback",
                        kind: "list",
                        sections: [
                            { type: "heading", text: "Feedback Admin" },
                            { type: "paragraph", text: "List of submissions (placeholder UI)." }
                        ]
                    }
                ]
            },
            constraints: goal.constraints
        };
        const C_deps = {
            feature: { id: featureId, title: `${baseTitle} (persisted)`, summary: "Adds persistence (not recommended if avoiding deps)." },
            target,
            intent: {
                pages: [
                    {
                        name: "Feedback",
                        title: "Feedback",
                        routeHint: "/feedback",
                        kind: "form",
                        sections: [
                            { type: "heading", text: "Feedback" },
                            { type: "paragraph", text: "Persisted submissions (requires backend or storage)." }
                        ]
                    },
                    {
                        name: "FeedbackAdmin",
                        title: "Feedback Admin",
                        routeHint: "/admin/feedback",
                        kind: "list",
                        sections: [
                            { type: "heading", text: "Feedback Admin" },
                            { type: "paragraph", text: "View submissions (requires backend or storage)." }
                        ]
                    }
                ]
            },
            constraints: goal.constraints
        };
        const candidates = [
            { id: "A", title: "Minimal feedback page", summary: "One route + one page. Smallest footprint.", intent: A, assumptions: ["No auth required for /feedback"] },
            { id: "B", title: "Feedback + admin list", summary: "Adds an admin view route. Still no deps.", intent: B, assumptions: ["Admin route is acceptable in this app"] },
        ];
        if (!wantsAvoidDeps(goal.constraints)) {
            candidates.push({ id: "C", title: "Feedback + persistence (concept)", summary: "Shows how persistence would fit (requires extra work).", intent: C_deps, assumptions: ["Persistence mechanism available"] });
        }
        return candidates;
    }
    if (recipe === "settings") {
        const A = {
            feature: { id: featureId, title: `${baseTitle} (single page)`, summary: "A single settings page with tabs placeholder." },
            target,
            intent: {
                pages: [
                    {
                        name: "Settings",
                        title: "Settings",
                        routeHint: "/settings",
                        kind: "dashboard",
                        sections: [
                            { type: "heading", text: "Settings" },
                            { type: "paragraph", text: "Profile + notifications placeholders." }
                        ]
                    }
                ]
            },
            constraints: goal.constraints
        };
        const B = {
            feature: { id: featureId, title: `${baseTitle} (split pages)`, summary: "Separate profile + notifications routes for clarity." },
            target,
            intent: {
                pages: [
                    { name: "SettingsProfile", title: "Profile Settings", routeHint: "/settings/profile", kind: "form", sections: [{ type: "heading", text: "Profile Settings" }] },
                    { name: "SettingsNotifications", title: "Notification Settings", routeHint: "/settings/notifications", kind: "form", sections: [{ type: "heading", text: "Notification Settings" }] }
                ]
            },
            constraints: goal.constraints
        };
        return [
            { id: "A", title: "Single settings page", summary: "Smallest change, easiest review.", intent: A, assumptions: ["No auth requirements specified"] },
            { id: "B", title: "Split settings routes", summary: "More structure, still small.", intent: B, assumptions: ["Nested routes are acceptable"] },
        ];
    }
    const A = {
        feature: { id: featureId, title: `${baseTitle} (playground)`, summary: "A demo page for trying WebSpec outputs." },
        target: "react-vite-shadcn-tailwind4",
        intent: {
            pages: [
                {
                    name: "Playground",
                    title: "Playground",
                    routeHint: "/playground",
                    kind: "static",
                    sections: [
                        { type: "heading", text: "Playground" },
                        { type: "paragraph", text: "Generated by WebSpec. Use this to validate routing + UI patterns." },
                        { type: "callout", text: "This is a safe demo page: no backend needed." }
                    ]
                }
            ]
        },
        constraints: goal.constraints
    };
    const B = {
        feature: { id: featureId, title: `${baseTitle} (docs)`, summary: "A /docs page for lightweight documentation." },
        target: "react-vite-shadcn-tailwind4",
        intent: {
            pages: [
                {
                    name: "Docs",
                    title: "Docs",
                    routeHint: "/docs",
                    kind: "static",
                    sections: [
                        { type: "heading", text: "Docs" },
                        { type: "paragraph", text: "Start documenting your app here." }
                    ]
                }
            ]
        },
        constraints: goal.constraints
    };
    return [
        { id: "A", title: "Playground page", summary: "A single safe page for experimenting.", intent: A, assumptions: ["No auth required"] },
        { id: "B", title: "Docs page", summary: "A simple /docs route.", intent: B, assumptions: ["No auth required"] },
    ];
}
//# sourceMappingURL=proposer.js.map